<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>school guide</title>
<script>
	var posName=[];
	var posDis=[];
	var posX=[],posY=[];
	//
	var edges=[];
	<?php
		
		require "php/dblogin.php";
		$result=mysqli_query($con,"select * from vertexinfo where ishide=0");
		
		while ($row=mysqli_fetch_array($result))
		{
			echo 'posName["'.$row['vertexid'].'"]="'.$row['name'].'";';
			echo 'posDis["'.$row['vertexid'].'"]="'.$row['discript'].'";';
			echo 'posX["'.$row['vertexid'].'"]="'.$row['x'].'";';
			echo 'posY["'.$row['vertexid'].'"]="'.$row['y'].'";';
		}
		
		$result=mysqli_query($con,"select fromv,tov from edgeinfo where fromv not in 
			(select vertexid from vertexinfo where ishide=1) and tov not in (select vertexid from vertexinfo where ishide=1)");
		
		while ($row=mysqli_fetch_array($result))
		{
			echo $row['fromv'].$row['tov']."\n";
			echo 'edges["'.$row['fromv'].'"]="'.$row['tov'].'";';
		}
	?>
	
	var selectPos=-1;
	function changeShowPos(ind){
		var nameBar=document.getElementById("showPosName");
		var discBar=document.getElementById("showPosDis");	
		nameBar.innerHTML=posName[ind];
		discBar.innerHTML=posDis[ind];			
		changeSelectPos(ind);
	}
	function changeSelectPos(ind){
		selectPos=ind;
		enableBut();
	}
	function enableBut(){
		document.getElementById("deleteBut").disabled=false;
		document.getElementById("changeBut").disabled=false;		
	}
</script>
<link href="css/mapLayout.css" rel="stylesheet" type="text/css" />
</head>

<body>
	<div style="float:left;width:70%">
        <!--点的坐标比线端点坐标要减去圆的半径-->
		<div id="posField">
		</div>
		<script>
		//画出所有地点
			var posField=document.getElementById("posField");
			for (var index in posName)
			{
				var str="<div class=\"position flexCenter infoFont\" style=\"top:"+posY[index]+"px;left:"+posX[index]+"px;\""+
				"onclick=\"changeShowPos(\'"+index+"\')\"><img src=\"image/location-sign.png\" style=\"float:left\"/>"+
				"<div style=\"float:left\">"+
				posName[index]+
				"</div>"+
				"</div>";
				posField.innerHTML+=str;
			}
		</script>
        
        <canvas id="canvas" width="1000px" height="700px" style="border:solid black 1px;float:left">
            <script>
            //画路线
                var c=document.getElementById("canvas");
                var ctx=c.getContext("2d");
				for (var fromv in edges)
				{
					var tov=edges[fromv];
					ctx.moveTo(posX[fromv],posY[fromv]);
					ctx.lineTo(posX[tov],posY[tov]);
					ctx.stroke();
				}
            </script>
        </canvas>
    </div>
    <div style="float:left" style="width:20%">
        <div class="bar">
        	<div class="titleFont">地名
            </div>
            <div id="showPosName" class="infoFont" style="height:100px;width:100%">
            </div>
            <div class="titleFont">信息
            </div>
            <div id="showPosDis" class="infoFont" style="height:200px;width:100%">
            </div>        
        </div>
        <div class="bar">
    		<div style="clear:both"></div>
        	<button value="增加点" onclick="window.location.href='addVertex.html'">增加点
            </button>
            <button id="deleteBut" disabled="disabled" value="删除点">删除点
            </button>
            <button id="changeBut" disabled="disabled" value="修改点相邻的边">修改点相邻的边
            </button>
        </div>
    </div>
    <div style="clear:both"></div>
    
    
</body>
</html>
