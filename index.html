<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>school guide</title>
<script src="js/drawMap.js"></script>
<script>
	
	window.onload=drawMap;
	<?php require "php/setPositionInfoArray.php";?>
	
	var selectPos=-1;
	
	function deletePos(){
		var name=posName[selectPos];
		window.location.href="php/deleteVertex.php?vertexname="+name;
	}
	
	function updatePos(){
		var name=posName[selectPos];
		window.location.href="php/updateVertex.html?vertexname="+name;
	}
	
	function changeShowPos(ind){
		var nameBar=document.getElementById("showPosName");
		var discBar=document.getElementById("showPosDis");	
		nameBar.innerHTML=posName[ind];
		discBar.innerHTML=posDis[ind];			
		changeSelectPos(ind);
	}
	function changeSelectPos(ind){
		selectPos=ind;
		enableBut();
	}
	function enableBut(){
		document.getElementById("deleteBut").disabled=false;
		document.getElementById("changeBut").disabled=false;		
	}
	//计算最短路
	function func1(){
		var fromv=document.getElementById("shortpathfrom").value,
			tov=document.getElementById("shortpathto").value;
		var str="shortpathfrom="+fromv+"&shortpathto="+tov;
		var xmlHttp=getXMLHttpRequest("POST","php/shortPath&Maxflow.php");
		xmlHttp.send(str);
		xmlHttp.onreadystatechange=function(){
			if (xmlHttp.readyState==4)
			// 4 = "loaded"
				if (xmlHttp.status==200)
				{// 200 = OK
					alert("ok!"+xmlHttp.responseText);
					var res=xmlHttp.responseText;
					var resArray=res.split("-");
					document.getElementById("shortpathans").innerHTML=Math.round(resArray[0]*1.3125)+"米";
					
					//重画红色路径
					reDrawRedLine(resArray);
				}
				else	alert("xmlHttp request failed");
		 };	 
	}
	
	//开启并返回一个xmlhttprequest对象（未发送数据）
	function getXMLHttpRequest(method,action)
	{
		var xmlHttp=null;
		if (window.XMLHttpRequest)
		{// code for IE7, Firefox, Opera, etc.
			xmlHttp=new XMLHttpRequest();
		}
		else if (window.ActiveXObject)
		{// code for IE6, IE5
			xmlHttp=new ActiveXObject("Microsoft.XMLHTTP");
		}
		if (xmlHttp!=null)
		{
			xmlHttp.open(method,action, true);
			xmlHttp.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
			return xmlHttp;
		}
	}
	
	function getCanvasHandle(){
		var c=document.getElementById("canvas");
        var ctx=c.getContext("2d");
	//	ctx.beginPath();
		return ctx;
	}
</script>
<link href="css/mapLayout.css" rel="stylesheet" type="text/css" />
<style>
	.blackBut{
		height:50px;
		background-color:#B7CDE1;
		border:1px black inset;
		color:black;
		border-radius:50px;
		min-width:100px;	
	}
	.blackBut:active{
		opacity:0.6;
	}
	
	button{
		margin:5px 0 0 5px;
	}
	
	.cross{
		width:10px;
		height:10px;
		border-radius:10px;
		border:solid 1px white;
		background-color:white;
		position:absolute;
		box-shadow:0 0 2px black;
	}
</style>

</head>

<body>
	<div style="float:left;width:75%">
        <!--点的坐标比线端点坐标要减去圆的半径-->
		<div id="posField">
		</div>
		<script>
		//画出所有地点
			drawPos();
		</script>
        <img src="image/map.jpg" style="display:none" id="mapPic"/>
        <canvas id="canvas" width="1085px" height="529px" style="border:solid black 1px;float:left">
            
        </canvas>
    </div>
    <div style="float:left;width:20%">
        <div class="bar">
        	<div class="titleFont">地名
            </div>
            <div id="showPosName" class="infoFont" style="height:100px;width:100%">
            </div>
            <div class="titleFont">信息
            </div>
            <div id="showPosDis" class="infoFont" style="height:200px;width:100%">
            </div>        
        </div>
        <div class="bar">
    		<div style="clear:both"></div>
        	<button class="titleFont" value="增加点" onclick="window.location.href='addVertex.html'">增加点
            </button>
            <button class="titleFont" id="deleteBut" disabled="disabled" value="删除点" onclick="deletePos()">删除点
            </button>
			<button class="titleFont" id="updateBut" disabled="disabled" value="修改点" onclick="updatePos()">修改点
            </button>
            <button class="titleFont" id="changeBut" disabled="disabled" value="修改点相邻的边">修改点相邻的边
            </button>
        </div>
		<div class="bar">
			<input type="text" id="shortpathfrom" />
			<input type="text" id="shortpathto" />
			<div class="infoFont" id="shortpathans"></div>
			<button type="submit" onclick="func1()">最短路</button>
		</div>
    </div>
    <div style="clear:both"></div>
    
    
</body>
</html>
